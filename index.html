<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Ð¨ÐºÐ¾Ð»ÑŒÐ½Ñ‹Ð¹ Ñ‡Ð°Ñ‚</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
html,body{
  margin:0;height:100%;
  font-family:Arial,sans-serif;
  background:#ece5dd
}
.chat{
  position:fixed;inset:0;
  display:flex;flex-direction:column;
  background:#fff
}
.header{
  background:#075e54;color:#fff;
  padding:14px;text-align:center;
  font-weight:bold;font-size:18px
}
.profile{
  padding:8px;background:#f0f0f0;
  display:flex;gap:6px;flex-direction:column
}
.profile input{padding:8px;border-radius:20px;border:1px solid #ccc}
#messages{
  flex:1;overflow-y:auto;
  padding:10px;background:#dcf8c6
}
.msg{
  display:flex;gap:8px;
  margin-bottom:10px;max-width:80%
}
.msg.me{margin-left:auto;flex-direction:row-reverse}
.avatar{
  width:36px;height:36px;border-radius:50%;
  background:#888;color:#fff;
  display:flex;align-items:center;justify-content:center;
  font-weight:bold;flex-shrink:0;object-fit:cover
}
.bubble{
  background:#fff;padding:8px 12px;
  border-radius:10px;font-size:14px;
  word-wrap:break-word
}
.msg.me .bubble{background:#e1ffc7}
.del{
  font-size:12px;color:red;cursor:pointer;
  margin-top:4px
}
.input{
  display:flex;gap:6px;
  padding:8px;background:#f0f0f0
}
.input input{
  flex:1;padding:10px;
  border-radius:20px;border:1px solid #ccc
}
button{
  border:none;border-radius:20px;
  padding:0 16px;
  background:#075e54;color:#fff;font-size:16px
}
</style>
</head>

<body>
<div class="chat">
  <div class="header">ðŸ’¬ Ð¨ÐºÐ¾Ð»ÑŒÐ½Ñ‹Ð¹ Ñ‡Ð°Ñ‚</div>

  <div class="profile">
    <input id="name" placeholder="Ð˜Ð¼Ñ">
    <input type="file" id="avatarFile" accept="image/*">
  </div>

  <div id="messages"></div>

  <div class="input">
    <input id="text" placeholder="Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ">
    <button onclick="send()">âž¤</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyDIwoHwl4-jNlXysDTUTrT7X38o8X5YMjw",
  authDomain:"schooll-chat.firebaseapp.com",
  databaseURL:"https://schooll-chat-default-rtdb.firebaseio.com",
  projectId:"schooll-chat"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const ref=db.ref("messages");

const nameInput=document.getElementById("name");
const avatarInput=document.getElementById("avatarFile");
const messagesDiv=document.getElementById("messages");

nameInput.value=localStorage.name||"";
let avatarData=localStorage.avatar||"";

avatarInput.onchange=()=>{
  const file=avatarInput.files[0];
  if(!file)return;
  const r=new FileReader();
  r.onload=()=>{avatarData=r.result;localStorage.avatar=avatarData}
  r.readAsDataURL(file);
};

nameInput.oninput=()=>localStorage.name=nameInput.value;

ref.on("child_added",snap=>{
  const m=snap.val();
  const key=snap.key;
  const me=m.name===nameInput.value;

  const div=document.createElement("div");
  div.className="msg"+(me?" me":"");

  const avatar=m.avatar
    ? `<img class="avatar" src="${m.avatar}">`
    : `<div class="avatar">${m.name[0]}</div>`;

  div.innerHTML=`
    ${avatar}
    <div>
      <div class="bubble"><b>${m.name}</b><br>${m.text}</div>
      ${me?`<div class="del" onclick="del('${key}')">ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ</div>`:""}
    </div>
  `;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop=messagesDiv.scrollHeight;
});

function send(){
  if(!nameInput.value||!text.value)return;
  ref.push({
    name:nameInput.value,
    text:text.value,
    avatar:avatarData||""
  });
  text.value="";
}

function del(key){
  ref.child(key).remove();
}
</script>
</body>
  </html>
